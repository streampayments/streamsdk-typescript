{"version":3,"sources":["../src/http.ts","../src/sdk.ts"],"sourcesContent":["export class StreamSDKError extends Error {\n    public readonly status: number;\n    public readonly requestId?: string;\n    public readonly body?: unknown;\n  \n    constructor(message: string, opts: { status: number; requestId?: string; body?: unknown }) {\n      super(message);\n      this.name = \"StreamSDKError\";\n      this.status = opts.status;\n      if (opts.requestId !== undefined) {\n        this.requestId = opts.requestId;\n      }\n      if (opts.body !== undefined) {\n        this.body = opts.body;\n      }\n    }\n  }\n  \n  export type Auth =\n    | { kind: \"apiKey\"; apiKey: string } // uses header x-api-key (per OpenAPI)  [oai_citation:2‡stream-app-service.streampay.sa](https://stream-app-service.streampay.sa/openapi.json)\n    | { kind: \"bearer\"; token: string }\n    | { kind: \"none\" };\n  \n  export type HttpClientOptions = {\n    baseUrl: string;\n    auth: Auth;\n    fetchFn?: typeof fetch;\n    userAgent?: string;\n  };\n  \n  function joinUrl(baseUrl: string, path: string) {\n    return `${baseUrl.replace(/\\/+$/, \"\")}${path.startsWith(\"/\") ? \"\" : \"/\"}${path}`;\n  }\n  \n  export class HttpClient {\n    private readonly baseUrl: string;\n    private readonly fetchFn: typeof fetch;\n    private readonly userAgent: string;\n    private auth: Auth;\n  \n    constructor(opts: HttpClientOptions) {\n      this.baseUrl = opts.baseUrl;\n      this.fetchFn = opts.fetchFn ?? fetch;\n      this.userAgent = opts.userAgent ?? \"stream-sdk/0.1.0\";\n      this.auth = opts.auth;\n    }\n  \n    setAuth(auth: Auth) {\n      this.auth = auth;\n    }\n  \n    async request<TResponse>(opts: {\n      method: \"GET\" | \"POST\" | \"PUT\" | \"DELETE\";\n      path: string;\n      query?: Record<string, string | number | boolean | null | undefined>;\n      body?: unknown;\n    }): Promise<TResponse> {\n      const url = new URL(joinUrl(this.baseUrl, opts.path));\n      if (opts.query) {\n        for (const [k, v] of Object.entries(opts.query)) {\n          if (v === undefined || v === null) continue;\n          url.searchParams.set(k, String(v));\n        }\n      }\n  \n      const headers: Record<string, string> = {\n        \"accept\": \"application/json\",\n        \"content-type\": \"application/json\",\n        \"user-agent\": this.userAgent\n      };\n  \n      if (this.auth.kind === \"apiKey\") {\n        headers[\"x-api-key\"] = this.auth.apiKey;\n      } else if (this.auth.kind === \"bearer\") {\n        headers[\"authorization\"] = `Bearer ${this.auth.token}`;\n      }\n  \n      const fetchOptions: RequestInit = {\n        method: opts.method,\n        headers\n      };\n\n      if (opts.body !== undefined) {\n        fetchOptions.body = JSON.stringify(opts.body);\n      }\n\n      const res = await this.fetchFn(url.toString(), fetchOptions);\n  \n      const requestId = res.headers.get(\"x-request-id\") ?? undefined;\n  \n      const text = await res.text();\n      const maybeJson = text ? safeJsonParse(text) : undefined;\n  \n      if (!res.ok) {\n        const msg =\n          (maybeJson && typeof maybeJson === \"object\" && maybeJson && \"detail\" in maybeJson && String((maybeJson as any).detail)) ||\n          `HTTP ${res.status} calling ${opts.method} ${opts.path}`;\n        const errorOpts: { status: number; requestId?: string; body?: unknown } = { status: res.status };\n        if (requestId !== undefined) {\n          errorOpts.requestId = requestId;\n        }\n        if (maybeJson !== undefined) {\n          errorOpts.body = maybeJson;\n        } else {\n          errorOpts.body = text;\n        }\n        throw new StreamSDKError(msg, errorOpts);\n      }\n  \n      return (maybeJson ?? (undefined as unknown)) as TResponse;\n    }\n  }\n  \n  function safeJsonParse(s: string) {\n    try {\n      return JSON.parse(s);\n    } catch {\n      return undefined;\n    }\n  }","import { HttpClient, type Auth } from \"./http\";\nimport type {\n  // Consumers\n  ConsumerCreate,\n  ConsumerResponse,\n  ConsumerUpdate,\n  ConsumerListResponse,\n  // Products\n  ProductCreate,\n  ProductDto,\n  ProductUpdate,\n  ProductListResponse,\n  // Payment Links\n  CreateLinkInput,\n  CreatePaymentLinkDto,\n  PaymentLinkDetailed,\n  PaymentLinkListResponse,\n  SimplePaymentLinkInput,\n  SimplePaymentLinkResponse,\n  // Coupons\n  CouponCreate,\n  CouponDetailed,\n  CouponUpdate,\n  CouponListResponse,\n  // Invoices\n  InvoiceDetailed,\n  InvoiceListResponse,\n  // Payments\n  PaymentResponse,\n  PaymentListResponse,\n  PaymentRefundRequest,\n  // Subscriptions\n  SubscriptionCreate,\n  SubscriptionDetailed,\n  SubscriptionUpdate,\n  SubscriptionListResponse,\n  SubscriptionCancel,\n  FreezeSubscriptionCreateRequest,\n  FreezeSubscriptionBase,\n  FreezeSubscriptionUpdateRequest,\n  FreezeListResponse,\n  // Pagination\n  PaginationParams,\n} from \"./types\";\n\n/**\n * Default baseUrl comes from OpenAPI servers list.  [oai_citation:3‡stream-app-service.streampay.sa](https://stream-app-service.streampay.sa/openapi.json)\n */\nconst DEFAULT_BASE_URL = \"https://stream-app-service.streampay.sa\";\n\nexport type StreamSDKInitOptions = {\n  baseUrl?: string;\n  /**\n   * If you want to use bearer token instead of apiKey, pass bearerToken.\n   * OpenAPI shows endpoints accept either JWTBearer or APIKey.  [oai_citation:4‡stream-app-service.streampay.sa](https://stream-app-service.streampay.sa/openapi.json)\n   */\n  bearerToken?: string;\n  fetchFn?: typeof fetch;\n};\n\nexport default class StreamSDK {\n  static init(apiKey: string, opts: StreamSDKInitOptions = {}) {\n    const auth: Auth =\n      opts.bearerToken ? { kind: \"bearer\", token: opts.bearerToken } :\n      apiKey ? { kind: \"apiKey\", apiKey } :\n      { kind: \"none\" };\n\n    const httpOptions: { baseUrl: string; auth: Auth; fetchFn?: typeof fetch; userAgent: string } = {\n      baseUrl: opts.baseUrl ?? DEFAULT_BASE_URL,\n      auth,\n      userAgent: \"stream-sdk/0.1.0\"\n    };\n\n    if (opts.fetchFn !== undefined) {\n      httpOptions.fetchFn = opts.fetchFn;\n    }\n\n    const http = new HttpClient(httpOptions);\n\n    return new StreamClient(http);\n  }\n}\n\nexport class StreamClient {\n  constructor(private readonly http: HttpClient) {}\n\n  /**\n   * Helper to build request options with optional query params\n   */\n  private buildGetRequest(path: string, query?: Record<string, any>): { method: \"GET\"; path: string; query?: Record<string, string | number | boolean | null | undefined> } {\n    const opts: { method: \"GET\"; path: string; query?: Record<string, string | number | boolean | null | undefined> } = {\n      method: \"GET\",\n      path\n    };\n    if (query !== undefined) {\n      opts.query = query;\n    }\n    return opts;\n  }\n\n  // ===========================\n  // CONSUMERS\n  // ===========================\n\n  /**\n   * Create a new consumer\n   * POST /api/v2/consumers\n   */\n  createConsumer(input: ConsumerCreate): Promise<ConsumerResponse> {\n    return this.http.request<ConsumerResponse>({\n      method: \"POST\",\n      path: \"/api/v2/consumers\",\n      body: input\n    });\n  }\n\n  /**\n   * @deprecated Use createConsumer instead\n   */\n  createUser(input: ConsumerCreate): Promise<ConsumerResponse> {\n    return this.createConsumer(input);\n  }\n\n  /**\n   * List all consumers with pagination\n   * GET /api/v2/consumers\n   */\n  listConsumers(params?: PaginationParams): Promise<ConsumerListResponse> {\n    const opts: { method: \"GET\"; path: string; query?: Record<string, string | number | boolean | null | undefined> } = {\n      method: \"GET\",\n      path: \"/api/v2/consumers\"\n    };\n    if (params !== undefined) {\n      opts.query = params;\n    }\n    return this.http.request<ConsumerListResponse>(opts);\n  }\n\n  /**\n   * Get a specific consumer by ID\n   * GET /api/v2/consumers/{consumer_id}\n   */\n  getConsumer(consumerId: string): Promise<ConsumerResponse> {\n    return this.http.request<ConsumerResponse>({\n      method: \"GET\",\n      path: `/api/v2/consumers/${consumerId}`\n    });\n  }\n\n  /**\n   * Update a consumer\n   * PUT /api/v2/consumers/{org_consumer_id}\n   */\n  updateConsumer(consumerId: string, input: ConsumerUpdate): Promise<ConsumerResponse> {\n    return this.http.request<ConsumerResponse>({\n      method: \"PUT\",\n      path: `/api/v2/consumers/${consumerId}`,\n      body: input\n    });\n  }\n\n  /**\n   * Delete a consumer\n   * DELETE /api/v2/consumers/{org_consumer_id}\n   */\n  deleteConsumer(consumerId: string): Promise<void> {\n    return this.http.request<void>({\n      method: \"DELETE\",\n      path: `/api/v2/consumers/${consumerId}`\n    });\n  }\n\n  // ===========================\n  // PRODUCTS\n  // ===========================\n\n  /**\n   * Create a new product\n   * POST /api/v2/products\n   */\n  createProduct(input: ProductCreate): Promise<ProductDto> {\n    return this.http.request<ProductDto>({\n      method: \"POST\",\n      path: \"/api/v2/products\",\n      body: input\n    });\n  }\n\n  /**\n   * List all products with pagination\n   * GET /api/v2/products\n   */\n  listProducts(params?: PaginationParams): Promise<ProductListResponse> {\n    return this.http.request<ProductListResponse>(this.buildGetRequest(\"/api/v2/products\", params));\n  }\n\n  /**\n   * Get a specific product by ID\n   * GET /api/v2/products/{product_id}\n   */\n  getProduct(productId: string): Promise<ProductDto> {\n    return this.http.request<ProductDto>({\n      method: \"GET\",\n      path: `/api/v2/products/${productId}`\n    });\n  }\n\n  /**\n   * Update a product\n   * PUT /api/v2/products/{product_id}\n   */\n  updateProduct(productId: string, input: ProductUpdate): Promise<ProductDto> {\n    return this.http.request<ProductDto>({\n      method: \"PUT\",\n      path: `/api/v2/products/${productId}`,\n      body: input\n    });\n  }\n\n  /**\n   * Delete a product\n   * DELETE /api/v2/products/{product_id}\n   */\n  deleteProduct(productId: string): Promise<void> {\n    return this.http.request<void>({\n      method: \"DELETE\",\n      path: `/api/v2/products/${productId}`\n    });\n  }\n\n  // ===========================\n  // COUPONS\n  // ===========================\n\n  /**\n   * Create a new coupon\n   * POST /api/v2/coupons\n   */\n  createCoupon(input: CouponCreate): Promise<CouponDetailed> {\n    return this.http.request<CouponDetailed>({\n      method: \"POST\",\n      path: \"/api/v2/coupons\",\n      body: input\n    });\n  }\n\n  /**\n   * List all coupons with pagination\n   * GET /api/v2/coupons\n   */\n  listCoupons(params?: PaginationParams): Promise<CouponListResponse> {\n    return this.http.request<CouponListResponse>(this.buildGetRequest(\"/api/v2/coupons\", params));\n  }\n\n  /**\n   * Get a specific coupon by ID\n   * GET /api/v2/coupons/{coupon_id}\n   */\n  getCoupon(couponId: string): Promise<CouponDetailed> {\n    return this.http.request<CouponDetailed>({\n      method: \"GET\",\n      path: `/api/v2/coupons/${couponId}`\n    });\n  }\n\n  /**\n   * Update a coupon\n   * PUT /api/v2/coupons/{coupon_id}\n   */\n  updateCoupon(couponId: string, input: CouponUpdate): Promise<CouponDetailed> {\n    return this.http.request<CouponDetailed>({\n      method: \"PUT\",\n      path: `/api/v2/coupons/${couponId}`,\n      body: input\n    });\n  }\n\n  /**\n   * Delete a coupon\n   * DELETE /api/v2/coupons/{coupon_id}\n   */\n  deleteCoupon(couponId: string): Promise<void> {\n    return this.http.request<void>({\n      method: \"DELETE\",\n      path: `/api/v2/coupons/${couponId}`\n    });\n  }\n\n  // ===========================\n  // INVOICES\n  // ===========================\n\n  /**\n   * List all invoices with pagination\n   * GET /api/v2/invoices\n   */\n  listInvoices(params?: PaginationParams): Promise<InvoiceListResponse> {\n    return this.http.request<InvoiceListResponse>(this.buildGetRequest(\"/api/v2/invoices\", params));\n  }\n\n  /**\n   * Get a specific invoice by ID\n   * GET /api/v2/invoices/{invoice_id}\n   */\n  getInvoice(invoiceId: string): Promise<InvoiceDetailed> {\n    return this.http.request<InvoiceDetailed>({\n      method: \"GET\",\n      path: `/api/v2/invoices/${invoiceId}`\n    });\n  }\n\n  // ===========================\n  // PAYMENTS\n  // ===========================\n\n  /**\n   * List all payments with optional invoice filter\n   * GET /api/v2/payments\n   */\n  listPayments(params?: { invoice_id?: string }): Promise<PaymentListResponse> {\n    return this.http.request<PaymentListResponse>(this.buildGetRequest(\"/api/v2/payments\", params));\n  }\n\n  /**\n   * Get a specific payment by ID\n   * GET /api/v2/payments/{payment_id}\n   */\n  getPayment(paymentId: string): Promise<PaymentResponse> {\n    return this.http.request<PaymentResponse>({\n      method: \"GET\",\n      path: `/api/v2/payments/${paymentId}`\n    });\n  }\n\n  /**\n   * Refund a payment\n   * POST /api/v2/payments/{payment_id}/refund\n   */\n  refundPayment(paymentId: string, input: PaymentRefundRequest): Promise<PaymentResponse> {\n    return this.http.request<PaymentResponse>({\n      method: \"POST\",\n      path: `/api/v2/payments/${paymentId}/refund`,\n      body: input\n    });\n  }\n\n  // ===========================\n  // SUBSCRIPTIONS\n  // ===========================\n\n  /**\n   * Create a new subscription\n   * POST /api/v2/subscriptions\n   */\n  createSubscription(input: SubscriptionCreate): Promise<SubscriptionDetailed> {\n    return this.http.request<SubscriptionDetailed>({\n      method: \"POST\",\n      path: \"/api/v2/subscriptions\",\n      body: input\n    });\n  }\n\n  /**\n   * List all subscriptions with pagination\n   * GET /api/v2/subscriptions\n   */\n  listSubscriptions(params?: PaginationParams): Promise<SubscriptionListResponse> {\n    return this.http.request<SubscriptionListResponse>(this.buildGetRequest(\"/api/v2/subscriptions\", params));\n  }\n\n  /**\n   * Get a specific subscription by ID\n   * GET /api/v2/subscriptions/{subscription_id}\n   */\n  getSubscription(subscriptionId: string): Promise<SubscriptionDetailed> {\n    return this.http.request<SubscriptionDetailed>({\n      method: \"GET\",\n      path: `/api/v2/subscriptions/${subscriptionId}`\n    });\n  }\n\n  /**\n   * Update a subscription\n   * PUT /api/v2/subscriptions/{subscription_id}\n   */\n  updateSubscription(subscriptionId: string, input: SubscriptionUpdate): Promise<SubscriptionDetailed> {\n    return this.http.request<SubscriptionDetailed>({\n      method: \"PUT\",\n      path: `/api/v2/subscriptions/${subscriptionId}`,\n      body: input\n    });\n  }\n\n  /**\n   * Cancel a subscription\n   * POST /api/v2/subscriptions/{subscription_id}/cancel\n   */\n  cancelSubscription(subscriptionId: string, input?: SubscriptionCancel): Promise<SubscriptionDetailed> {\n    return this.http.request<SubscriptionDetailed>({\n      method: \"POST\",\n      path: `/api/v2/subscriptions/${subscriptionId}/cancel`,\n      body: input\n    });\n  }\n\n  /**\n   * Freeze a subscription (pause invoice generation)\n   * POST /api/v2/subscriptions/{subscription_id}/freeze\n   */\n  freezeSubscription(subscriptionId: string, input: FreezeSubscriptionCreateRequest): Promise<FreezeSubscriptionBase> {\n    return this.http.request<FreezeSubscriptionBase>({\n      method: \"POST\",\n      path: `/api/v2/subscriptions/${subscriptionId}/freeze`,\n      body: input\n    });\n  }\n\n  /**\n   * List all freeze periods for a subscription\n   * GET /api/v2/subscriptions/{subscription_id}/freeze\n   */\n  listSubscriptionFreezes(subscriptionId: string): Promise<FreezeListResponse> {\n    return this.http.request<FreezeListResponse>({\n      method: \"GET\",\n      path: `/api/v2/subscriptions/${subscriptionId}/freeze`\n    });\n  }\n\n  /**\n   * Update a subscription freeze period\n   * PUT /api/v2/subscriptions/{subscription_id}/freeze/{freeze_id}\n   */\n  updateSubscriptionFreeze(\n    subscriptionId: string,\n    freezeId: string,\n    input: FreezeSubscriptionUpdateRequest\n  ): Promise<FreezeSubscriptionBase> {\n    return this.http.request<FreezeSubscriptionBase>({\n      method: \"PUT\",\n      path: `/api/v2/subscriptions/${subscriptionId}/freeze/${freezeId}`,\n      body: input\n    });\n  }\n\n  /**\n   * Delete a subscription freeze period\n   * DELETE /api/v2/subscriptions/{subscription_id}/freeze/{freeze_id}\n   */\n  deleteSubscriptionFreeze(subscriptionId: string, freezeId: string): Promise<void> {\n    return this.http.request<void>({\n      method: \"DELETE\",\n      path: `/api/v2/subscriptions/${subscriptionId}/freeze/${freezeId}`\n    });\n  }\n\n  // ===========================\n  // PAYMENT LINKS\n  // ===========================\n\n  /**\n   * Create a payment link (simplified interface)\n   * POST /api/v2/payment_links\n   */\n  async createLink(input: CreateLinkInput): Promise<PaymentLinkDetailed> {\n    const dto: CreatePaymentLinkDto = {\n      name: input.name,\n      description: input.description ?? null,\n\n      // Required by schema: items[]\n      items: [\n        {\n          // openapi types will enforce the correct keys; commonly it's product_id + quantity\n          product_id: input.productId,\n          quantity: input.quantity ?? 1\n        } as any\n      ],\n\n      coupons: input.coupons ?? [],\n      max_number_of_payments: input.maxNumberOfPayments ?? null,\n      valid_until: toIsoOrNull(input.validUntil),\n\n      success_redirect_url: input.successRedirectUrl ?? null,\n      failure_redirect_url: input.failureRedirectUrl ?? null,\n\n      organization_consumer_id: input.consumerId ?? null,\n      custom_metadata: input.customMetadata ?? null,\n      contact_information_type: input.contactInformationType ?? null\n    } as any;\n\n    return this.http.request<PaymentLinkDetailed>({\n      method: \"POST\",\n      path: \"/api/v2/payment_links\",\n      body: dto\n    });\n  }\n\n  /**\n   * Create a payment link (full interface with raw DTO)\n   * POST /api/v2/payment_links\n   */\n  createPaymentLink(input: CreatePaymentLinkDto): Promise<PaymentLinkDetailed> {\n    return this.http.request<PaymentLinkDetailed>({\n      method: \"POST\",\n      path: \"/api/v2/payment_links\",\n      body: input\n    });\n  }\n\n  /**\n   * List all payment links with pagination\n   * GET /api/v2/payment_links\n   */\n  listPaymentLinks(params?: PaginationParams): Promise<PaymentLinkListResponse> {\n    return this.http.request<PaymentLinkListResponse>(this.buildGetRequest(\"/api/v2/payment_links\", params));\n  }\n\n  /**\n   * Get a specific payment link by ID\n   * GET /api/v2/payment_links/{payment_link_id}\n   */\n  getPaymentLink(paymentLinkId: string): Promise<PaymentLinkDetailed> {\n    return this.http.request<PaymentLinkDetailed>({\n      method: \"GET\",\n      path: `/api/v2/payment_links/${paymentLinkId}`\n    });\n  }\n\n  /**\n   * SDK helper: returns a best-effort \"pay URL\" if the API returns one.\n   * (Field name can vary; we keep it defensive.)\n   */\n  getPaymentUrl(link: PaymentLinkDetailed): string | null {\n    const anyLink = link as any;\n    return (\n      anyLink?.payment_url ??\n      anyLink?.paymentUrl ??\n      anyLink?.url ??\n      anyLink?.link ??\n      anyLink?.redirect_url ??\n      anyLink?.checkout_url ??\n      null\n    );\n  }\n\n  // ===========================\n  // SIMPLIFIED PAYMENT LINK CREATION\n  // ===========================\n\n  /**\n   * Simplified one-step payment link creation with smart resource matching.\n   *\n   * This method handles:\n   * 1. Smart consumer matching: Searches for existing consumer by email/phone before creating\n   * 2. Smart product matching: Searches for existing products by name and price before creating\n   * 3. Creating payment link with the matched or newly created resources\n   * 4. Returning payment URL directly\n   *\n   * Resource Matching:\n   * - Consumer: Matched by phone (primary) or email (secondary) - Only ONE consumer per link\n   * - Products: Matched by name AND price (both must match) - Supports MULTIPLE products\n   * - Use `consumer.id` or `product.id` to skip matching and use specific resource\n   * - Use `options.forceCreate: true` to always create new resources\n   *\n   * @example\n   * ```typescript\n   * // Single product (reuses existing consumer/product if found)\n   * const result = await client.createSimplePaymentLink({\n   *   name: \"Order #1234\",\n   *   amount: 99.99,\n   *   consumer: {\n   *     email: \"customer@example.com\",\n   *     name: \"John Doe\"\n   *   },\n   *   product: {\n   *     name: \"Premium Subscription\",\n   *     price: 99.99\n   *   },\n   *   successRedirectUrl: \"https://example.com/success\"\n   * });\n   *\n   * // Multiple products\n   * const result = await client.createSimplePaymentLink({\n   *   name: \"Order #5678\",\n   *   consumer: {\n   *     phone: \"+966501234567\",\n   *     name: \"Jane Smith\"\n   *   },\n   *   products: [\n   *     { name: \"Product A\", price: 50.00, quantity: 2 },\n   *     { name: \"Product B\", price: 75.00, quantity: 1 }\n   *   ],\n   *   successRedirectUrl: \"https://example.com/success\"\n   * });\n   *\n   * // Force creation of new resources\n   * const result = await client.createSimplePaymentLink({\n   *   name: \"Order #1234\",\n   *   amount: 99.99,\n   *   consumer: { email: \"customer@example.com\", name: \"John Doe\" },\n   *   product: { name: \"Premium Subscription\", price: 99.99 },\n   *   options: { forceCreate: true }\n   * });\n   *\n   * // Use specific existing resources by ID\n   * const result = await client.createSimplePaymentLink({\n   *   name: \"Order #1234\",\n   *   consumer: { id: \"cons_123\" },\n   *   products: [\n   *     { id: \"prod_456\", quantity: 1 },\n   *     { id: \"prod_789\", quantity: 2 }\n   *   ]\n   * });\n   * ```\n   */\n  async createSimplePaymentLink(input: SimplePaymentLinkInput): Promise<SimplePaymentLinkResponse> {\n    let consumerId: string | undefined;\n    const productIds: string[] = [];\n    const forceCreate = input.options?.forceCreate ?? false;\n\n    // Step 1: Handle consumer creation (optional)\n    if (input.consumer) {\n      if (input.consumer.id) {\n        // Use provided consumer ID\n        consumerId = input.consumer.id;\n      } else if (input.consumer.email || input.consumer.phone || input.consumer.name) {\n        // Try to find existing consumer first (unless forceCreate is true)\n        let existingConsumer: ConsumerResponse | null = null;\n\n        if (!forceCreate) {\n          try {\n            const consumers = await this.listConsumers({ page: 1, size: 100 });\n\n            if (consumers.data && consumers.data.length > 0) {\n              existingConsumer = consumers.data.find((c: ConsumerResponse) => {\n                // Match by phone number (primary)\n                if (input.consumer?.phone && c.phone_number === input.consumer.phone) {\n                  return true;\n                }\n                // Match by email (secondary)\n                if (input.consumer?.email && c.email === input.consumer.email) {\n                  return true;\n                }\n                return false;\n              }) || null;\n            }\n          } catch (error) {\n            // If listing fails, proceed to create new consumer\n          }\n        }\n\n        if (existingConsumer) {\n          // Use existing consumer\n          consumerId = existingConsumer.id;\n        } else {\n          // Create new consumer\n          const consumerData: Partial<ConsumerCreate> = {};\n\n          if (input.consumer.name !== undefined) {\n            consumerData.name = input.consumer.name;\n          }\n          if (input.consumer.email !== undefined) {\n            consumerData.email = input.consumer.email;\n          }\n          if (input.consumer.phone !== undefined) {\n            consumerData.phone_number = input.consumer.phone;\n          }\n\n          if (consumerData.name || consumerData.email || consumerData.phone_number) {\n            const consumer = await this.createConsumer(consumerData as ConsumerCreate);\n            consumerId = consumer.id;\n          }\n        }\n      }\n    }\n\n    // Step 2: Handle product(s) creation - supports both single and multiple products\n    const productsToProcess = input.products || (input.product ? [input.product] : []);\n\n    if (productsToProcess.length === 0) {\n      throw new Error(\"At least one product must be provided (via 'product' or 'products')\");\n    }\n\n    // Process each product\n    for (const productInput of productsToProcess) {\n      let productId: string;\n\n      if (productInput.id) {\n        // Use provided product ID\n        productId = productInput.id;\n      } else {\n        const productName = productInput.name || input.name;\n        const productPrice = productInput.price || input.amount;\n\n        if (!productPrice) {\n          throw new Error(\"Product price must be provided either in product object or as 'amount'\");\n        }\n\n        // Try to find existing product first by name and price (unless forceCreate is true)\n        let existingProduct: ProductDto | null = null;\n\n        if (!forceCreate) {\n          try {\n            const products = await this.listProducts({ page: 1, size: 100 });\n\n            if (products.data && products.data.length > 0) {\n              existingProduct = products.data.find((p: ProductDto) => {\n                // Match by name and price\n                const priceMatch = parseFloat(String(p.price)) === parseFloat(String(productPrice));\n                const nameMatch = p.name === productName;\n\n                return nameMatch && priceMatch;\n              }) || null;\n            }\n          } catch (error) {\n            // If listing fails, proceed to create new product\n          }\n        }\n\n        if (existingProduct) {\n          // Use existing product\n          productId = existingProduct.id;\n        } else {\n          // Create new product\n          const productData: any = {\n            name: productName,\n            price: productPrice,\n            type: 'ONE_OFF',  // Default to one-time purchase\n            currency: productInput.currency || input.currency || 'SAR'  // Default to SAR\n          };\n\n          if (productInput.description !== undefined) {\n            productData.description = productInput.description;\n          }\n\n          const product = await this.createProduct(productData);\n          productId = product.id;\n        }\n      }\n\n      productIds.push(productId);\n    }\n\n    // Step 3: Build items array for payment link\n    const items = productsToProcess.map((productInput, index) => ({\n      product_id: productIds[index],\n      quantity: (productInput as any).quantity || input.quantity || 1\n    }));\n\n    // Step 4: Create payment link\n    const linkData: CreatePaymentLinkDto = {\n      name: input.name,\n      items: items as any,\n      coupons: input.coupons ?? [],\n      max_number_of_payments: input.maxNumberOfPayments ?? null,\n      valid_until: toIsoOrNull(input.validUntil),\n      success_redirect_url: input.successRedirectUrl ?? null,\n      failure_redirect_url: input.failureRedirectUrl ?? null,\n      organization_consumer_id: consumerId ?? null,\n      custom_metadata: input.customMetadata ?? null,\n      contact_information_type: input.contactInformationType ?? null\n    } as any;\n\n    if (input.description !== undefined) {\n      (linkData as any).description = input.description;\n    }\n\n    const paymentLink = await this.http.request<PaymentLinkDetailed>({\n      method: \"POST\",\n      path: \"/api/v2/payment_links\",\n      body: linkData\n    });\n\n    // Step 5: Extract payment URL\n    const paymentUrl = this.getPaymentUrl(paymentLink);\n\n    if (!paymentUrl) {\n      throw new Error(\"Payment link created but no payment URL was returned from the API\");\n    }\n\n    const response: SimplePaymentLinkResponse = {\n      paymentLink,\n      paymentUrl,\n      productIds,\n      productId: productIds[0],  // First product for backward compatibility\n      consumerId\n    };\n\n    return response;\n  }\n}\n\nfunction toIsoOrNull(v: Date | string | null | undefined): string | null {\n  if (!v) return null;\n  if (v instanceof Date) return v.toISOString();\n  // assume already ISO or acceptable date-time string per API\n  return v;\n}"],"mappings":"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","names":[]}